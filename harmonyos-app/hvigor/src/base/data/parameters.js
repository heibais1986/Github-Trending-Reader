"use strict";var __decorate=this&&this.__decorate||function(e,r,t,a){var o,_=arguments.length,s=_<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,t):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,a);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(_<3?o(s):_>3?o(r,t,s):o(r,t))||s);return _>3&&s&&Object.defineProperty(r,t,s),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExternalParameter=void 0;const wdk_1=require("@baize/wdk"),json_schema_util_js_1=require("@ohos/hvigor-common/src/util/json-schema-util.js"),fs_extra_1=require("fs-extra"),path_const_js_1=require("../../common/const/path-const.js"),hvigor_trace_factory_js_1=require("../common/trace/hvigor-trace-factory.js"),global_core_parameters_js_1=require("../internal/data/global-core-parameters.js"),hvigor_log_js_1=require("../log/hvigor-log.js"),object_util_js_1=require("../util/object-util.js");class ExternalParameter{constructor(){this.logger=hvigor_log_js_1.HvigorLogger.getLogger(ExternalParameter.name)}getExtParam(e){var r;return null===(r=this.getExtParams())||void 0===r?void 0:r[e]}getExtParams(){return(0,object_util_js_1.freezeDeep)((0,wdk_1.cloneDeep)(global_core_parameters_js_1.coreParameter.extParams))}getProperties(){return(0,object_util_js_1.freezeDeep)((0,wdk_1.cloneDeep)(global_core_parameters_js_1.coreParameter.properties))}getProperty(e){var r;return null===(r=this.getProperties())||void 0===r?void 0:r[e]}setProperty(e,r){this.propertiesSchema||(this.propertiesSchema=(0,fs_extra_1.readJsonSync)(path_const_js_1.HVIGOR_CONFIG_SCHEMA_PATH).properties.properties);const t=`${path_const_js_1.HVIGOR_CONFIG_SCHEMA_PATH}.properties.properties`,{isValid:a,errMsg:o}=(0,json_schema_util_js_1.validateDataBySchema)({[e]:r},t,this.propertiesSchema);let _=this.getCallerPath();a||this.logger.printErrorExitWithoutStack("METHID_SETPROPERTY_VALIDATE_FAILED_IN_HVIGORFILE",[_],[[o]]),global_core_parameters_js_1.coreParameter.properties[e]=r}getCallerPath(){const e=(new Error).stack;if(!e)return"";const r=e.split("\n");if(!r)return"";const t=r.find(e=>e.trim().startsWith("at plugin"));if(t){const e=t.match(/\((.*?):\d+:\d+\)$/);if(e&&e[1])return`At file: ${e[1]}`}return""}getStartParams(){return(0,object_util_js_1.freezeDeep)((0,wdk_1.cloneDeep)({daemon:global_core_parameters_js_1.coreParameter.startParams.daemon,analyze:global_core_parameters_js_1.AnalyzeModeKeyMap.get(global_core_parameters_js_1.coreParameter.startParams.analyze),parallel:global_core_parameters_js_1.coreParameter.startParams.parallelExecution,incremental:global_core_parameters_js_1.coreParameter.startParams.incrementalExecution,logLevel:global_core_parameters_js_1.coreParameter.startParams.logLevel.levelStr.toLowerCase(),typeCheck:global_core_parameters_js_1.coreParameter.startParams.hvigorfileTypeCheck,optimizationStrategy:global_core_parameters_js_1.coreParameter.startParams.optimizationStrategy,hotCompile:global_core_parameters_js_1.coreParameter.startParams.hotCompile,hotReloadBuild:global_core_parameters_js_1.coreParameter.startParams.hotReloadBuild}))}getWorkspaceDir(){return(0,object_util_js_1.freezeDeep)((0,wdk_1.cloneDeep)(global_core_parameters_js_1.coreParameter.workspaceDir))}}__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getExtParam",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getExtParams",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getProperties",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getProperty",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"setProperty",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getStartParams",null),__decorate([hvigor_trace_factory_js_1.TrackAPI],ExternalParameter.prototype,"getWorkspaceDir",null),exports.ExternalParameter=ExternalParameter;