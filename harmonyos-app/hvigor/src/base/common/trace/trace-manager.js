"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.traceManager=exports.TraceManager=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),fs_extra_1=__importDefault(require("fs-extra")),hvigor_common_1=require("@ohos/hvigor-common"),path_util_js_1=require("../../../common/util/path-util.js"),replacer_js_1=require("../../../common/util/replacer.js");class TraceManager{constructor(){this.callBackList={},this.data={},this.callBackList={}}trace(e,t,a){this.data[e]=t,"function"==typeof a&&(this.callBackList[e]=a)}flush(){const e=(0,wdk_1.cloneDeep)(this.data);for(const e in this.callBackList)this.callBackList[e]();const t=path_1.default.resolve(path_util_js_1.PathUtil.getHvigorCacheDir(),"./outputs/logs/details"),a=path_1.default.resolve(t,"details.json");fs_extra_1.default.ensureDirSync(t);try{fs_extra_1.default.writeFileSync(a,JSON.stringify(e,replacer_js_1.replacer,2))}catch(e){}}static transformKey(e){return e.replace(/\./g,"_")}static anonymize(e){return(0,hvigor_common_1.hash)(e)}static trace(e,t,a){exports.traceManager.trace(e,t,a)}}exports.TraceManager=TraceManager,exports.traceManager=new TraceManager;