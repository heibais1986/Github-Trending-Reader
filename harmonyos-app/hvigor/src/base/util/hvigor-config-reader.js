"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HvigorConfigReader=exports.defaultOptions=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),process_1=__importDefault(require("process")),const_js_1=require("../../common/const/const.js"),path_const_js_1=require("../../common/const/path-const.js"),hvigor_config_loader_js_1=require("../../common/util/hvigor-config-loader.js"),json5_reader_js_1=require("./json5-reader.js");exports.defaultOptions={maxOldSpaceSize:8192,maxSemiSpaceSize:16,exposeGC:!0};class HvigorConfigReader extends json5_reader_js_1.Json5Reader{static getHvigorConfig(){const e=path_1.default.resolve(path_const_js_1.HVIGOR_PROJECT_WRAPPER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);if(!fs_1.default.existsSync(e))return;const i=this.getJson5Obj(e),r=path_1.default.resolve(path_const_js_1.HVIGOR_USER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);let t;return fs_1.default.existsSync(r)&&(t=this.getJson5Obj(r),i.properties={...t.properties,...i.properties}),i}static getPropertiesConfigValue(e){return hvigor_config_loader_js_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(e)}static getMaxOldSpaceSize(e=!1){var i,r,t,o;const a=process_1.default.argv.find(e=>e.startsWith(this.maxOldSpaceSizeParamPrefiex)),s=Number(null!==(i=null==a?void 0:a.slice((null==a?void 0:a.indexOf("="))+1))&&void 0!==i?i:""),n=null===(t=null===(r=HvigorConfigReader.getHvigorConfig())||void 0===r?void 0:r.nodeOptions)||void 0===t?void 0:t.maxOldSpaceSize,l=process_1.default.execArgv.find(e=>e.startsWith(this.maxOldSpaceSizeParamPrefiex)),d={argv:s,config:n,execArgv:Number(null!==(o=null==l?void 0:l.slice((null==l?void 0:l.indexOf("="))+1))&&void 0!==o?o:""),default:exports.defaultOptions.maxOldSpaceSize};return this.getPriorVal(d,e)}static getMaxSemiSpaceSize(e=!1){var i,r,t,o;const a=process_1.default.argv.find(e=>e.startsWith(this.maxSemiSpaceSizeParamPrefiex)),s=Number(null!==(i=null==a?void 0:a.slice((null==a?void 0:a.indexOf("="))+1))&&void 0!==i?i:""),n=null===(t=null===(r=HvigorConfigReader.getHvigorConfig())||void 0===r?void 0:r.nodeOptions)||void 0===t?void 0:t.maxSemiSpaceSize,l=process_1.default.execArgv.find(e=>e.startsWith(this.maxSemiSpaceSizeParamPrefiex)),d={argv:s,config:n,execArgv:Number(null!==(o=null==l?void 0:l.slice((null==l?void 0:l.indexOf("="))+1))&&void 0!==o?o:""),default:exports.defaultOptions.maxSemiSpaceSize};return this.getPriorVal(d,e)}static getNodeParamFromProcessArgv(){const e=[];for(const i of[this.maxOldSpaceSizeParamPrefiex,this.maxSemiSpaceSizeParamPrefiex]){const r=process_1.default.argv.find(e=>e.startsWith(i));r&&e.push(r)}return e}static getPriorVal(e,i){return i?e.config||e.default:e.argv||e.config||e.execArgv||e.default}}exports.HvigorConfigReader=HvigorConfigReader,HvigorConfigReader.maxOldSpaceSizeParamPrefiex="--max-old-space-size=",HvigorConfigReader.maxSemiSpaceSizeParamPrefiex="--max-semi-space-size=";