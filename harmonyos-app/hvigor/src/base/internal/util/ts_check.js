"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setHvigorConfigFileTsRoot=exports.formatDiagnostic=exports.doCompilePluginTypeCheck=exports.hvigorfileTypeCheck=exports.hvigorConfigFileTsRoot=exports.targetModules=exports.targetRoots=exports.hvigorfileTSRoots=void 0;const process_1=__importDefault(require("process")),typescript_1=__importDefault(require("typescript")),hvigor_log_js_1=require("../../log/hvigor-log.js"),compile_options_js_1=require("../../util/options/compile-options.js"),time_util_js_1=require("../../util/time-util.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("ts-check");exports.hvigorfileTSRoots=new Set,exports.targetRoots=new Set,exports.targetModules=new Set;const formatHost={getCanonicalFileName:t=>t,getCurrentDirectory:typescript_1.default.sys.getCurrentDirectory,getNewLine:()=>typescript_1.default.sys.newLine};function hvigorfileTypeCheck(){const t=process_1.default.hrtime(),e=typescript_1.default.createProgram([...exports.targetRoots],compile_options_js_1.compilerOptions),o=typescript_1.default.getPreEmitDiagnostics(e),i=process_1.default.hrtime(t),r=(0,time_util_js_1.formatTime)(i);for(const t of o)log.error(formatDiagnostic(t,formatHost));o.length?log.printErrorExit("TYPE_ERRORS",[[...exports.targetRoots].join(", ")]):log.info(`TYPE CHECK SUCCESSFUL in ${r}`)}function doCompilePluginTypeCheck(t){const e=typescript_1.default.createProgram([t],{...compile_options_js_1.compilerOptions,noImplicitAny:!1,noImplicitReturns:!1,alwaysStrict:!1,declaration:!1}),o=typescript_1.default.getPreEmitDiagnostics(e);if(o.length){for(const t of o)log.error(formatDiagnostic(t,formatHost));log.printErrorExit("TYPE_ERRORS",[t])}}function formatDiagnostic(t,e,o){const i=`${diagnosticCategoryName(t)} TS${t.code}: ${typescript_1.default.flattenDiagnosticMessageText(t.messageText,e.getNewLine())}${e.getNewLine()}`;if(t.file){const{line:e,character:r}=typescript_1.default.getLineAndCharacterOfPosition(t.file,t.start);return`${i} at ${null!=o?o:t.file.fileName}:${e+1}:${r+1} `}return i}function diagnosticCategoryName(t,e=!0){const o=typescript_1.default.DiagnosticCategory[t.category];return e?o.toLowerCase():o}function setHvigorConfigFileTsRoot(t){exports.hvigorConfigFileTsRoot=t}exports.hvigorfileTypeCheck=hvigorfileTypeCheck,exports.doCompilePluginTypeCheck=doCompilePluginTypeCheck,exports.formatDiagnostic=formatDiagnostic,exports.setHvigorConfigFileTsRoot=setHvigorConfigFileTsRoot;