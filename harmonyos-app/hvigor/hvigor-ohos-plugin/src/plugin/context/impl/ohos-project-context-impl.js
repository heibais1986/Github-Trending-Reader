"use strict";var __decorate=this&&this.__decorate||function(e,t,o,r){var i,c=arguments.length,p=c<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(p=(c<3?i(p):c>3?i(t,o,p):i(t,o))||p);return c>3&&p&&Object.defineProperty(t,o,p),p},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OhosProjectContextImpl=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),build_option_path_info_js_1=require("../../../common/build-option-path-info.js"),core_product_js_1=require("../../../common/global/core-product.js"),core_project_profile_js_1=require("../../../common/global/core-project-profile.js"),build_directory_const_js_1=require("../../../const/build-directory-const.js"),common_const_js_1=require("../../../const/common-const.js"),build_mode_manager_js_1=require("../../../project/build-option/build-mode-manager.js"),oh_package_loader_1=require("../../../utils/loader/file/oh-package-loader"),project_build_profile_loader_js_1=require("../../../utils/loader/file/project-build-profile-loader.js"),res_model_loader_js_1=require("../../../utils/loader/file/res-model-loader.js");class OhosProjectContextImpl{constructor(e,t){this.logger=hvigor_1.HvigorLogger.getLogger(OhosProjectContextImpl.name),this.projectPlugin=e,this.projectPath=this.projectPlugin.getProjectModel().getProject().getNodeDir(),this.taskService=t,this.projectOhPackagePath=path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.OH_PACKAGE_JSON5),res_model_loader_js_1.resModelLoader.initSchemaPath(this.taskService.getSdkInfo().getAppSchema(),this.taskService.getSdkInfo().getModuleSchema()),this.initCurrentProduct(),this.initBuildPath()}getOhpmDependencyInfo(){return this.taskService.getOhpmDependencyInfo()}getOhpmRemoteHspDependencyInfo(e=!1){var t;return this.taskService.getOhpmRemoteHspDependencies(this.taskService,null===(t=this.currentProduct)||void 0===t?void 0:t.getProductName(),e)}getProjectName(){return this.projectPlugin._project.getName()}getBuildMode(){return build_mode_manager_js_1.BuildModeManager.getBuildMode()}getProjectPath(){return this.projectPlugin._project.getNodeDir()}getCurrentProduct(){return this.currentProduct}initCurrentProduct(){const e=core_project_profile_js_1.CoreProjectProfile.getInstance(this.projectPath).getCurrentProductOpt();this.currentProduct=new core_product_js_1.CoreProduct(e,this.taskService.getProjectModel())}initBuildPath(){this.buildRootPath=this.taskService.getPathInfo().getProjectBuildPath(),this.buildProductOutputPath=path_1.default.resolve(this.buildRootPath,build_directory_const_js_1.BuildDirConst.BUILD_OUTPUTS,this.currentProduct.getProductName())}getBuildProductOutputPath(){return this.buildProductOutputPath}getBuildRootPath(){return this.buildRootPath}getAppJsonOpt(){return(0,wdk_1.cloneDeep)(res_model_loader_js_1.resModelLoader.getAppJson(path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.APP_SCOPE,common_const_js_1.CommonConst.APP_CONFIG)))}getBuildProfileOpt(){return(0,wdk_1.cloneDeep)(project_build_profile_loader_js_1.projectBuildProfileLoader.getBuildProfile())}setAppJsonOpt(e){this.taskService.isFaMode()&&this.logger.printErrorExit("FA_MODE_NOT_SUPPORT_MODIFY_FILE",["app.json5"]);const t=path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.APP_SCOPE,common_const_js_1.CommonConst.APP_CONFIG);res_model_loader_js_1.resModelLoader.setAppJson(t,e),build_option_path_info_js_1.buildOptionPath.setAppConfigPath(t,e,(0,build_option_path_info_js_1.getHookFilePath)())}setBuildProfileOpt(e){var t;this.taskService.isFaMode()&&this.logger.printErrorExit("FA_MODE_NOT_SUPPORT_MODIFY_FILE",["buildProfile"]),project_build_profile_loader_js_1.projectBuildProfileLoader.checkBuildProfile(project_build_profile_loader_js_1.projectBuildProfileLoader.getBuildProfile(),e),project_build_profile_loader_js_1.projectBuildProfileLoader.setBuildProfileJson5Obj(this.getProjectName(),e),null===(t=this.projectPlugin.getProjectModel())||void 0===t||t.refreshData(),this.projectPlugin.initBuildOptionMap((0,build_option_path_info_js_1.getHookFilePath)()),this.taskService.refreshData()}getDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDependenciesOpt(this.projectOhPackagePath))}getDevDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDevDependenciesOpt(this.projectOhPackagePath))}getDynamicDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDynamicDependenciesOpt(this.projectOhPackagePath))}setDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDependenciesOpt(this.projectOhPackagePath,e)}setDevDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDevDependenciesOpt(this.projectOhPackagePath,e)}setDynamicDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDynamicDependenciesOpt(this.projectOhPackagePath,e)}getOverrides(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getOverrides(this.projectOhPackagePath))}setOverrides(e){oh_package_loader_1.ohPackageLoader.setOverrides(this.projectOhPackagePath,e)}}__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getOhpmDependencyInfo",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getOhpmRemoteHspDependencyInfo",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getProjectName",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getBuildMode",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getProjectPath",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getCurrentProduct",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getBuildProductOutputPath",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getBuildRootPath",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getAppJsonOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getBuildProfileOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setAppJsonOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setBuildProfileOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getDevDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getDynamicDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setDevDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setDynamicDependenciesOpt",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"getOverrides",null),__decorate([hvigor_1.TrackAPI],OhosProjectContextImpl.prototype,"setOverrides",null),exports.OhosProjectContextImpl=OhosProjectContextImpl;