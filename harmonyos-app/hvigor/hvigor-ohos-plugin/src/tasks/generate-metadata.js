"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var o=Object.getOwnPropertyDescriptor(t,a);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,o)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__decorate=this&&this.__decorate||function(e,t,a,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(s<3?o(n):s>3?o(t,a,n):o(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateMetadata=void 0;const hvigor_1=require("@ohos/hvigor"),fse=__importStar(require("fs-extra")),common_const_js_1=require("../const/common-const.js"),abstract_generate_metadata_js_1=require("./abstract/abstract-generate-metadata.js"),task_names_js_1=require("./common/task-names.js"),global_project_data_service_js_1=require("./service/global-project-data-service.js"),sign_module_remote_hsp_js_1=require("./sign-module-remote-hsp.js");var Task=task_names_js_1.TaskNames.Task;class GenerateMetadata extends abstract_generate_metadata_js_1.AbstractGenerateMetadata{constructor(e){super(e,Task.GENERATE_METADATA),this._hspDepsTarget=new Map}get jsonPath(){return this.sourceSetModel.getModuleTargetRes().getJsonPath()}get relatedEntryJsonList(){return this.getRelatedEntryJsonList(common_const_js_1.CommonConst.MODULE_JSON5)}initTaskDependsForOtherModule(){this.service.getHspModuleDependencyNames().forEach(e=>{var t,a,r;for(const o of[this.targetData.getTargetName(),common_const_js_1.DefaultTargetConst.DEFAULT_TARGET]){const s=this.targetData.findTargetDataByName(e,o);if(void 0===s)continue;const n=`${null!==(t=s.getTargetName())&&void 0!==t?t:common_const_js_1.DefaultTargetConst.DEFAULT_TARGET}@${Task.GENERATE_METADATA.name}`;if(null===(a=this.node.findModuleByName(e))||void 0===a?void 0:a.getTaskByName(n))return this._hspDepsTarget.set(e,null!==(r=null==s?void 0:s.getTargetName())&&void 0!==r?r:common_const_js_1.DefaultTargetConst.DEFAULT_TARGET),void this.declareDepends(n,e)}})}getDistroFilterObj(e){var t,a;return null!==(a=null===(t=null==e?void 0:e.getTargetOpt().config)||void 0===t?void 0:t.distroFilter)&&void 0!==a?a:void 0}initTaskDepends(){const e=this.service.getProjectModel().getRemoteHspPath(),t=this.moduleModel.getRemoteHspPath(),a=global_project_data_service_js_1.GlobalProjectDataService.getInstance().getModuleRemoteHspPromise().has(this.moduleName);(fse.existsSync(e)||fse.existsSync(t))&&(a||(global_project_data_service_js_1.GlobalProjectDataService.getInstance().setModuleRemoteHspPromise(this.moduleName),this.dependsOn(`${this.targetData.getTargetName()}@${sign_module_remote_hsp_js_1.SignModuleRemoteHsp.name}`)))}}__decorate([(0,hvigor_1.InputFile)()],GenerateMetadata.prototype,"jsonPath",null),__decorate([(0,hvigor_1.InputFiles)()],GenerateMetadata.prototype,"relatedEntryJsonList",null),exports.GenerateMetadata=GenerateMetadata;