"use strict";var __decorate=this&&this.__decorate||function(e,t,o,i){var r,l=arguments.length,s=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(l<3?r(s):l>3?r(t,o,s):r(t,o))||s);return l>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildProfileTask=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),project_ohos_config_manager_js_1=require("../common/global/project-ohos-config-manager.js"),common_const_js_1=require("../const/common-const.js"),build_profile_utils_js_1=require("../utils/build-profile-utils.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),task_util_js_1=require("../utils/task-util.js"),task_names_js_1=require("./common/task-names.js"),ohos_hap_task_js_1=require("./task/ohos-hap-task.js");var CommonTask=task_names_js_1.TaskNames.CommonTask;class BuildProfileTask extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,CommonTask.CREATE_BUILD_PROFILE),this._log=ohos_logger_js_1.OhosLogger.getLogger(BuildProfileTask.name),this.buildTaskService=e,this.initDefaultData()}initDefaultData(){var e,t,o,i,r,l,s,a,u;const n=this.projectModel.getAppRes().getAppResOpt(),d=(0,wdk_1.cloneDeep)(this.projectOhosConfigAppOpt),_=this.targetData.getProduct();this.buildProfileData={BUNDLE_NAME:null!==(t=null!==(e=null==d?void 0:d.bundleName)&&void 0!==e?e:this.targetData.getProduct().bundleName)&&void 0!==t?t:this.projectModel.getDefaultBundleName(),BUNDLE_TYPE:null!==(r=null!==(i=null!==(o=null==d?void 0:d.bundleType)&&void 0!==o?o:_.bundleType)&&void 0!==i?i:n.app.bundleType)&&void 0!==r?r:common_const_js_1.BundleType.APP,VERSION_CODE:null!==(s=null!==(l=null==d?void 0:d.versionCode)&&void 0!==l?l:_.versionCode)&&void 0!==s?s:n.app.versionCode,VERSION_NAME:null!==(u=null!==(a=null==d?void 0:d.versionName)&&void 0!==a?a:_.versionName)&&void 0!==u?u:n.app.versionName,TARGET_NAME:this.targetName,PRODUCT_NAME:this.targetData.getProduct().name,BUILD_MODE_NAME:this.buildModeName,DEBUG:this.buildTaskService.isDebug()}}get buildMode(){return this.targetService.getBuildMode()}get buildModeName(){return(0,task_util_js_1.getBuildModeName)()}get buildProfileFields(){return this.targetService.getBuildProfileFields()}get projectOhosConfigAppOpt(){var e;return null===(e=project_ohos_config_manager_js_1.projectOhosConfigManager.getOverrides())||void 0===e?void 0:e.appOpt}get appResJsonPath(){return this.service.getProjectModel().getAppRes().getJsonPath()}get projectProfilePath(){return this.projectModel.getProfilePath()}get buildProfilePath(){return this.pathInfo.getGenerateBuildProfilePath(this.targetService.getTargetData().getTargetName())}initTaskDepends(){}doTaskAction(){const e=this.buildProfileFields?{...this.buildProfileData,...this.buildProfileFields}:{...this.buildProfileData};hvigor_1.LocalFileWriter.getInstance().writeStr(this.buildProfilePath,(0,build_profile_utils_js_1.normalizedFileData)(e,this.targetData,this._log))}}__decorate([(0,hvigor_1.Input)()],BuildProfileTask.prototype,"buildMode",null),__decorate([(0,hvigor_1.Input)()],BuildProfileTask.prototype,"buildModeName",null),__decorate([(0,hvigor_1.Input)()],BuildProfileTask.prototype,"buildProfileFields",null),__decorate([(0,hvigor_1.Input)()],BuildProfileTask.prototype,"projectOhosConfigAppOpt",null),__decorate([(0,hvigor_1.InputFile)()],BuildProfileTask.prototype,"appResJsonPath",null),__decorate([(0,hvigor_1.InputFile)()],BuildProfileTask.prototype,"projectProfilePath",null),__decorate([(0,hvigor_1.OutputFile)()],BuildProfileTask.prototype,"buildProfilePath",null),exports.BuildProfileTask=BuildProfileTask;