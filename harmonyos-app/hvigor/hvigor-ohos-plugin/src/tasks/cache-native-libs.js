"use strict";var __decorate=this&&this.__decorate||function(e,t,i,s){var a,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CacheNativeLibs=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),abstract_native_strip_js_1=require("./abstract/abstract-native-strip.js"),task_names_js_1=require("./common/task-names.js"),do_native_strip_js_1=require("./do-native-strip.js"),cache_libs_js_1=require("./worker/cache-libs.js");class CacheNativeLibs extends abstract_native_strip_js_1.AbstractNativeStrip{get cacheStrippedNativeLibs(){return this.strippedNativeLibs}get buildCacheFilePath(){return this.cacheFilePath}constructor(e){super(e,task_names_js_1.TaskNames.Task.CACHE_NATIVE_LIBS),this.logger=ohos_logger_js_1.OhosLogger.getLogger(CacheNativeLibs.name)}async doTaskAction(){const e=path_1.default.resolve(__dirname,"./worker/cache-libs.js/cacheNativeLibs"),t={workInput:{intermediatesProcessLibs:this.intermediatesProcessLibs,strippedNativeLibs:this.cacheStrippedNativeLibs,cacheFilePath:this.buildCacheFilePath,debugSymbol:this.debugSymbol}};if(this.getWorkerPool().submit(this,e,t).getState()===hvigor_1.TaskState.REJECT){const e="cache native libs",i=this.durationEvent.createSubEvent(e,"");i.start(),this.logger.debug("Worker dispatch failed, running cacheNativeLibs on main thread."),await(0,cache_libs_js_1.cacheNativeLibs)(t.workInput),i.stop(),i.setLog(e,hvigor_1.MetricLogType.INFO)}}initTaskDepends(){this.declareDepends(do_native_strip_js_1.DoNativeStrip.name)}}__decorate([(0,hvigor_1.InputFile)({isDirectory:!0})],CacheNativeLibs.prototype,"cacheStrippedNativeLibs",null),__decorate([(0,hvigor_1.OutputFile)({isDirectory:!1})],CacheNativeLibs.prototype,"buildCacheFilePath",null),exports.CacheNativeLibs=CacheNativeLibs;