"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PreCheckSyscap=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),common_const_js_1=require("../const/common-const.js"),array_util_js_1=require("../utils/array-util.js"),json_util_js_1=require("../utils/json-util.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),ohos_hap_task_js_1=require("./task/ohos-hap-task.js");class PreCheckSyscap extends ohos_hap_task_js_1.OhosHapTask{constructor(o,s){var t;super(o,s),this._log=ohos_logger_js_1.OhosLogger.getLogger(PreCheckSyscap.name);const e=o.getTargetData().getTargetName();this.sourceRoot=null===(t=this.service.getModuleModel())||void 0===t?void 0:t.getSourceRootByTargetName(e),this.jsonFilePath=path_1.default.resolve(this.sourceRoot,this.service.isFaMode()?common_const_js_1.CommonConst.CONFIG_JSON:common_const_js_1.CommonConst.MODULE_JSON5),this.sysCapJsonPath=path_1.default.resolve(this.sourceRoot,common_const_js_1.CommonConst.SYSCAP_JSON)}doTaskAction(){if(this.targetData.isHarmonyOS())return;const o=this.moduleModel.getJsonProfileByModel(this.service,this.targetName);if(0!==o.deviceTypes.length||fs_extra_1.default.existsSync(this.sysCapJsonPath)||this._log.printErrorExit("JSON_PROFILE_MISSING",[this.moduleName,common_const_js_1.CommonConst.SYSCAP_JSON,common_const_js_1.CommonConst.PCID_SC,this.jsonFilePath],[[common_const_js_1.CommonConst.MODULE_JSON5,this.moduleName,common_const_js_1.CommonConst.PCID_SC]]),fs_extra_1.default.existsSync(this.sysCapJsonPath)){const s=(0,json_util_js_1.getJson5Obj)(this.sysCapJsonPath).devices.general;0===o.deviceTypes.length?s&&0!==s.length&&this._log.printErrorExit("SYSCAP_FIELD_NOT_EMPTY",[common_const_js_1.CommonConst.DEVICES_GENERAL,common_const_js_1.CommonConst.SYSCAP_JSON,o.deviceConfig,this.moduleName,o.configurationProfile,this.sysCapJsonPath],[[common_const_js_1.CommonConst.DEVICES_GENERAL,common_const_js_1.CommonConst.SYSCAP_JSON,o.deviceConfig,this.moduleName,o.configurationProfile]]):s&&(0,array_util_js_1.checkArrayElementIsSame)(s,o.deviceTypes)||this._log.printErrorExit("DEVICE_TYPE_NOT_INCONSISTENT",[common_const_js_1.CommonConst.DEVICES_GENERAL,this.sysCapJsonPath],[[common_const_js_1.CommonConst.DEVICES_GENERAL,common_const_js_1.CommonConst.SYSCAP_JSON,o.deviceConfig,this.moduleName,o.configurationProfile]])}}initTaskDepends(){}}exports.PreCheckSyscap=PreCheckSyscap;