"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildHotReloadResource=void 0;const find_target_product_js_1=require("../../common/find-target-product.js"),compile_mode_enum_js_1=require("../../enum/compile-mode-enum.js"),hap_extra_info_js_1=require("../../project/data/hap-extra-info.js"),error_url_js_1=require("../../utils/error-url.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_util_js_1=require("../../utils/task-util.js"),task_names_js_1=require("../common/task-names.js"),compile_resource_js_1=require("../compile-resource.js"),generate_loader_json_js_1=require("../generate-loader-json.js"),abstract_module_hook_task_js_1=require("../hook/abstract-module-hook-task.js");class BuildHotReloadResource extends abstract_module_hook_task_js_1.AbstractModuleHookTask{constructor(e){super(e,!1,task_names_js_1.TaskNames.CommonHookTask.BUILD_HOT_RELOAD_RES),this._log=ohos_logger_js_1.OhosLogger.getLogger(BuildHotReloadResource.name),this.registryAction=()=>{const e=this._moduleService.getModuleModel(),o=(0,find_target_product_js_1.findTargetProduct)(e.getParentProject()),r=e.getCompileApiMetaByProduct(o.name).version;return()=>{(e.getCompileMode(o)!==compile_mode_enum_js_1.CompileModeEnum.ES_MODULE||e.getApiType()!==hap_extra_info_js_1.ApiType.STAGE||r<9)&&this._log.printErrorExit("HOT_RELOAD_PROHIBIT",[e.getProfilePath()],[[error_url_js_1.ErrorUrl.ERROR_URL.hotReload]]),this._log.debug("Hot reload resources ready.")}}}initTaskDepends(e){this.dependsOn((0,task_util_js_1.resolveHookDependency)(generate_loader_json_js_1.GenerateLoaderJson.name,e.getTargetData().getTargetName())),this.dependsOn((0,task_util_js_1.resolveHookDependency)(compile_resource_js_1.CompileResource.name,e.getTargetData().getTargetName()))}}exports.BuildHotReloadResource=BuildHotReloadResource;