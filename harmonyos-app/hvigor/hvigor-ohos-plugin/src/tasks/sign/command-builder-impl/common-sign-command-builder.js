"use strict";var __importDefault=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommonSignCommandBuilder=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),build_option_path_info_js_1=require("../../../common/build-option-path-info.js"),decipher_util_js_1=require("../../../utils/decipher-util.js"),ohos_logger_js_1=require("../../../utils/log/ohos-logger.js"),sdk_version_js_1=require("../../../version/sdk-version.js");class CommonSignCommandBuilder{constructor(i,t,e,o,r){this._log=ohos_logger_js_1.OhosLogger.getLogger(CommonSignCommandBuilder.name),this._keyStorePwd="",this._keyPwd="",this._projectModel=i,this._signingConfig=t,this._sdkInfo=e,this._signModel=o,this._signingOptions=r;const s=this._sdkInfo.getToolchainsComponentVersion();void 0!==s&&(this._toolchainsComponentVersion=new sdk_version_js_1.SdkVersion(s))}getSignCommand(){const i=this._signingConfig.material;return this.checkValidMaterial(i),this.initCommandParams(i),this._signingOptions.addCalledJarFile(this.getSignTool()),this._signingOptions.build()}getKeyStorePwd(){return this._keyStorePwd=decipher_util_js_1.DecipherUtil.decryptPwd(path_1.default.resolve(this._signingConfig.material.storeFile,".."),this._signingConfig.material.storePassword),this._keyStorePwd}readKeyStorePwd(){return this._keyStorePwd}getKeyPwd(){return this._keyPwd=decipher_util_js_1.DecipherUtil.decryptPwd(path_1.default.resolve(this._signingConfig.material.storeFile,".."),this._signingConfig.material.keyPassword),this._keyPwd}readKeyPwd(){return this._keyPwd}checkValidMaterial(i){void 0===i&&this._log.printErrorExit("THE_MATERIAL_HAS_NOT_BEEN_CONFIGURED_IN_SIGNINGCONFIGS",[this._projectModel.getProfilePath()]),this.validateMaterial(i.storeFile,"storeFile"),this.validateMaterial(i.profile,"profile"),this.validateMaterial(i.certpath,"certpath"),i.storeFile=this.normalizePath(i.storeFile),i.profile=this.normalizePath(i.profile),i.certpath=this.normalizePath(i.certpath)}normalizePath(i){return path_1.default.isAbsolute(i)?i:path_1.default.resolve(this._projectModel.getProjectDir(),i)}validateMaterial(i,t){void 0!==i&&fs_1.default.existsSync(this.normalizePath(i))||this._log.printErrorExit("INVALID_%S_VALUE_MAKE_SURE_IT_IS_NOT_NULL_OR_EMPTY",[t,i,build_option_path_info_js_1.buildOptionPath.getSignConfigPath(this._projectModel,t)])}validateSignType(i){void 0===this._signingConfig.type&&(this._signingConfig.type="OpenHarmony"),this._signingConfig.type!==i&&this._log.printErrorExit("SIGNING_CONFIGURATION_%S_DOES_NOT_APP_TO_%S",[this._signingConfig.name,i,this._projectModel.getProfilePath()])}}exports.CommonSignCommandBuilder=CommonSignCommandBuilder;