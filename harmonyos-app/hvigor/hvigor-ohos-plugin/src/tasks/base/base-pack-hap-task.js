"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,a){void 0===a&&(a=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,a,o)}:function(e,t,s,a){void 0===a&&(a=s),e[a]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.packageHapDepends=exports.BasePackHapTask=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),hvigor_arkts_compose_1=require("@ohos/hvigor-arkts-compose"),const_1=require("@ohos/hvigor/src/common/const/const"),hvigor_config_loader_1=require("@ohos/hvigor/src/common/util/hvigor-config-loader"),fse=__importStar(require("fs-extra")),packing_tool_options_js_1=require("../../builder/inner-java-command-builder/packing-tool-options.js"),project_ohos_config_manager_js_1=require("../../common/global/project-ohos-config-manager.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),common_const_js_1=require("../../const/common-const.js"),sdk_const_js_1=require("../../const/sdk-const.js"),aot_compile_mode_enum_js_1=require("../../enum/aot-compile-mode-enum.js"),code_type_enum_js_1=require("../../enum/code-type-enum.js"),module_type_enum_js_1=require("../../enum/module-type-enum.js"),dependency_interface_js_1=require("../../project/dependency/core/dependency-interface.js"),dependency_manager_js_1=require("../../project/dependency/dependency-manager.js"),inject_util_js_1=require("../../utils/inject-util.js"),integrated_hsp_utils_js_1=require("../../utils/integrated-hsp-utils.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),process_utils_js_1=require("../../utils/process-utils.js"),sourcemap_util_js_1=require("../../utils/sourcemap-util.js"),task_util_js_1=require("../../utils/task-util.js"),abstract_merge_profile_js_1=require("../abstract-merge-profile.js"),cache_native_libs_js_1=require("../cache-native-libs.js"),task_names_js_1=require("../common/task-names.js"),generate_metadata_js_1=require("../generate-metadata.js"),make_pack_info_js_1=require("../make-pack-info.js"),pack_hap_request_js_1=require("../pack/pack-hap-request.js"),process_integrated_hsp_js_1=require("../process-integrated-hsp.js"),process_router_map_js_1=require("../process-router-map.js"),process_startup_config_js_1=require("../process-startup-config.js"),module_task_service_js_1=require("../service/module-task-service.js"),syscap_transform_js_1=require("../syscap-transform.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js"),ohosTestTargetName=common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET;class BasePackHapTask extends ohos_hap_task_js_1.OhosHapTask{declareExecutionTool(){return this.sdkInfo.getPackageTool()}declareExecutionCommand(){const e=[];for(let t=0;t<this.allPackInfoPath.length;t++)e.push(this.generateCommand(this.allPackInfoPath[t],this.allOutPath[t]).toString());return e.join()}declareInputFiles(){const e=(new hvigor_1.FileSet).addEntries([this.libPath,this.jsonPath,this.resourcePath,this.indexPath,...this.allPackInfoPath],{isDirectory:!1});fse.existsSync(this.rpcidSc)&&e.addEntry(this.rpcidSc,{isDirectory:!1}),fse.existsSync(this.jsAssetsPath)&&e.addEntry(this.jsAssetsPath,{isDirectory:!1}),fse.existsSync(this.etsAssetsPath)&&e.addEntry(this.etsAssetsPath,{isDirectory:!1}),fse.existsSync(this.nodeModulesPath)&&e.addEntry(this.nodeModulesPath,{isDirectory:!0}),fse.existsSync(this.pkgContextInfoPath)&&e.addEntry(this.pkgContextInfoPath,{isDirectory:!1});const t=this.getSourceMapSourcePath();fse.existsSync(t)&&e.addEntry(t,{isDirectory:!1});const s=this.targetService.getTargetData().getTargetName(),a=this.pathInfo.getGenerateBuildProfilePath(s);return fse.existsSync(a)&&e.addEntry(a),e}declareOutputFiles(){const e=(new hvigor_1.FileSet).addEntries([...this.allOutPath],{isDirectory:!1});if(this.integratedHsp&&this.allOutPath.forEach(t=>{e.addEntry(path_1.default.resolve(this.pathInfo.getModuleBuildOutputPath(),path_1.default.basename(t)),{isDirectory:!1})}),this.sdkInfo.hasRollUpPluginInEtsLoader)if(e.addEntry(path_1.default.resolve(this.sourceMapInterDirPath,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP)),hvigor_1.coreParameter.properties[const_1.OHOS_ARK_COMPILE_SOURCE_MAP_DIR]){const t=this.getSourceMapPath(hvigor_1.coreParameter.properties[const_1.OHOS_ARK_COMPILE_SOURCE_MAP_DIR]);e.addEntry(path_1.default.resolve(t,this.moduleName,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP),{isDirectory:!1})}else e.addEntry(path_1.default.resolve(this.pathInfo.getDefaultSourceMapPath(),build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP));return e}constructor(e,t,s,a){var o,i;super(e,t),this.allPackInfoPath=[],this.allOutPath=[],this._log=ohos_logger_js_1.OhosLogger.getLoggerWithDurationId("base-pack-hap-task",this.durationEvent.getId()),this.mode=s;const r=this.targetService.getTargetData(),n=r.getPathInfo();this.libPath=n.getIntermediatesStrippedLibsDir(),this.jsonPath=path_1.default.resolve(n.getIntermediatesRes(),common_const_js_1.CommonConst.MODULE_JSON),this.packageHapJsonPath=path_1.default.resolve(this.pathInfo.getPackageHapProductPath(),common_const_js_1.CommonConst.MODULE_JSON),this.pkgContextInfoPath=path_1.default.resolve(this.pathInfo.getIntermediatesLoaderPath(),common_const_js_1.CommonConst.PKG_CONTEXT_INFO_JSON),this.resourcePath=path_1.default.resolve(n.getIntermediatesRes(),build_directory_const_js_1.BuildDirConst.RESTOOL_BUILD_RESOURCES),this.indexPath=path_1.default.resolve(n.getIntermediatesRes(),build_directory_const_js_1.BuildArtifactConst.RESOURCE_INDEX),this.rpcidSc=path_1.default.resolve(n.getIntermediatesSysCap(),common_const_js_1.CommonConst.RPCID_SC),this.jsAssetsPath=path_1.default.resolve(n.getInterMediatesLoaderOutPath(),code_type_enum_js_1.CodeType.JS),this.etsAssetsPath=path_1.default.resolve(n.getInterMediatesLoaderOutPath(),code_type_enum_js_1.CodeType.ETS),this.nodeModulesPath=path_1.default.resolve(n.getInterMediatesLoaderOutPath(),common_const_js_1.CommonNodeConst.NODE_MODULES),this.syscapJsonPath=path_1.default.resolve(null===(o=this.moduleModel)||void 0===o?void 0:o.getSourceRootByTargetName(this.targetName),common_const_js_1.CommonConst.SYSCAP_JSON),this.sourceMapInterDirPath=n.getInterMediatesSourceMapDirPath(),this.fastAppDirPath=n.getFastAppStorageDirectory(),this.anBuildOutputPath=path_1.default.resolve(this.pathInfo.getInterMediatesLoaderOutPath(),aot_compile_mode_enum_js_1.AotCompileModeEnum.AN),this.moduleBuildOpt=this.moduleModel.getProfileOpt(),this.buildOption=this.targetService.getBuildOption(),this.apDirPath=this.pathInfo.getIntermediatesApPath(),this.integratedHsp=this.moduleModel.isHspModule()&&!!(null===(i=this.targetService.getBuildOption().arkOptions)||void 0===i?void 0:i.integratedHsp);const c=this.integratedHsp?n.getIntegratedHspOutputPath():n.getModuleBuildOutputPath();fse.existsSync(c)||fse.mkdirSync(c,{recursive:!0});const _=this.service.getRelatedEntryModules(),d=this.service.getModuleModel().getModuleType();if(module_task_service_js_1.ModuleTaskService.checkEntryModules(d,_))for(const e of _)this.module.findModuleByName(e)&&(this.allPackInfoPath.push(path_1.default.resolve(n.getModuleBuildOutputPath(),e,build_directory_const_js_1.BuildArtifactConst.PACK_INFO)),this.allOutPath.push(path_1.default.resolve(c,r.getModuleTargetOutputFileName(e,!1))));else this.allPackInfoPath.push(path_1.default.resolve(n.getModuleBuildOutputPath(),build_directory_const_js_1.BuildArtifactConst.PACK_INFO)),this.allOutPath.push(path_1.default.resolve(c,r.getModuleTargetOutputFileName("",!1,this.getSuffix())))}declareInputs(){var e,t,s;const a=(new Map).set("hotReload",inject_util_js_1.InjectUtil.isHotReload()).set(build_directory_const_js_1.BuildDirConst.INTEGRATED_HSP,this.integratedHsp).set(abstract_merge_profile_js_1.INPUT_KEY.projectConfigAppOpt,JSON.stringify(null===(e=project_ohos_config_manager_js_1.projectOhosConfigManager.getOverrides())||void 0===e?void 0:e.signingConfig));return this.moduleModel.getModuleType()!==module_type_enum_js_1.ModuleType.Har&&(null===(t=this.buildOption)||void 0===t?void 0:t.debuggable)&&a.set("sourceMapDir",null!==(s=hvigor_1.coreParameter.properties[const_1.OHOS_ARK_COMPILE_SOURCE_MAP_DIR])&&void 0!==s?s:""),a}async doTaskAction(){for(let e=0;e<this.allPackInfoPath.length;e++)await this.executeCommandList(this.allPackInfoPath[e],this.allOutPath[e]);this.generateInterSourceMap(),this.moveSourceMap(),await this.replaceSourceMapInCoverageMode()}async executeCommandList(e,t){const s=this.generatePackInputData(e,t);try{await this.executePackInJavaDaemon(s)}catch(e){this._log.debug(`java daemon remote pack failed: ${null==e?void 0:e.message}. fallback to local java -jar pack`),await this.executePackInWorkerPool(s)}}generatePackInputData(e,t){const s=this.durationEvent.createSubEvent("generate HAP packaging command","");s.start(),this.checkCompressNativeLib();const a=this.generateCommand(e,t);this._log._printDebugCommand(this.sdkInfo.getPackageTool(),a);const o={moduleName:this.moduleName,taskName:this.name,commandLine:a,integratedHspCommand:this.integratedHsp?(0,integrated_hsp_utils_js_1.generateIntegratedHspCommand)(this.projectModel,this.sdkInfo.getPackageTool(),t,this.pathInfo.getModuleBuildOutputPath()):void 0};return s.stop(),s.setLog(s.getName(),hvigor_1.MetricLogType.INFO),o}async sendPackHapRequest(e){if(e){const t={command:e.slice(e.indexOf(this.sdkInfo.getPackageTool())+1)};await(0,pack_hap_request_js_1.sendPackRequest)(this.sdkInfo.getPackageTool(),t)}}async executePackInJavaDaemon(e){const t="submit HAP packaging task to java daemon server",s=this.durationEvent.createSubEvent(t,"Pack HAP in java daemon");s.start();try{await this.sendPackHapRequest(e.commandLine),await this.sendPackHapRequest(e.integratedHspCommand),s.setLog(t,hvigor_1.MetricLogType.INFO)}catch(e){throw s.setLog(t,hvigor_1.MetricLogType.WARN),e}finally{s.stop()}}async executePackInWorkerPool(e){const t="submit HAP packaging task to work pool",s=this.durationEvent.createSubEvent(t,"Pack HAP in work pool");s.start(),await new process_utils_js_1.ProcessUtils(e.moduleName,e.taskName).submitExecutionWithoutReturn(this,this.getWorkerPool(),e,wdk_1.noop,[],s),s.stop(),s.setLog(t,hvigor_1.MetricLogType.INFO)}checkCompressNativeLib(){this.moduleModel;const e=hvigor_config_loader_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(common_const_js_1.HvigorConfigConst.OHOS_PACK_COMPRESS_LEVEL);if(e&&fse.existsSync(path_1.default.resolve(this.pathInfo.getModulePath(),"libs"))){const t=common_const_js_1.HvigorConfigConst.OHOS_PACK_COMPRESS_LEVEL_MAP.get(e);if(this.compileApiVersion<12)return void this._log.warn(`Invalid ohos.pack.compressLevel configuration, ohos.pack.compressLevel configuration \n      minimum requirement is api 12 version of the project, your project is api ${this.compileApiVersion} project`);t||this._log.warn(`invalid ohos.pack.compress parameter:${e}\n      ,It won't work, the packing will follow the fast compression level.`)}}generateCommand(e,t){var s,a;const o=new packing_tool_options_js_1.PackingToolOptions;o.addCalledJarFile(this.sdkInfo.getPackageTool()),o.addMode(this.mode).force(!0).addLibPath(this.libPath).addJsonPath(this.packageHapJsonPath).addResourcesPath(this.resourcePath).addIndexPath(this.indexPath).addPackInfoPath(e).addOutPath(t);const i=hvigor_config_loader_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(common_const_js_1.HvigorConfigConst.OHOS_PACK_COMPRESS_LEVEL);return i&&fse.existsSync(path_1.default.resolve(this.pathInfo.getModulePath(),"libs"))&&o.addCompressLevel(i,this.sdkInfo.getSdkVersion()),this.targetService.getAnBuildMode()&&(fse.existsSync(this.anBuildOutputPath)&&o.addAnPath(this.anBuildOutputPath),fse.existsSync(this.apDirPath)&&o.addDirList([this.apDirPath])),fse.existsSync(this.rpcidSc)&&o.addSysCapPath(this.rpcidSc),fse.existsSync(this.jsAssetsPath)&&o.addJsPath(this.jsAssetsPath),fse.existsSync(this.etsAssetsPath)&&o.addEtsPath(this.etsAssetsPath),fse.existsSync(this.nodeModulesPath)&&o.addDirList([this.nodeModulesPath]),fse.existsSync(this.pkgContextInfoPath)&&(null===(a=null===(s=this.targetService.getBuildOption())||void 0===s?void 0:s.strictMode)||void 0===a?void 0:a.useNormalizedOHMUrl)&&o.addPkgContextInfoPath(this.pkgContextInfoPath),o.build()}getSuffix(){switch(this.mode){case"hap":default:return build_directory_const_js_1.BuildArtifactExtension.DOT_HAP;case"hsp":return build_directory_const_js_1.BuildArtifactExtension.DOT_HSP}}getSourceMapSourcePath(){var e;return(null===(e=this.buildOption)||void 0===e?void 0:e.debuggable)?path_1.default.resolve(this.etsAssetsPath,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP):path_1.default.resolve(this.pathInfo.getModuleBuildCachePath(),`${this.targetName}@CompileArkTS`,"esmodule","release",build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP)}generateInterSourceMap(){if(!this.sdkInfo.hasRollUpPluginInEtsLoader)return;const e=this.getSourceMapSourcePath();fse.existsSync(e)&&(fse.ensureDirSync(this.sourceMapInterDirPath),fse.copyFileSync(e,path_1.default.resolve(this.sourceMapInterDirPath,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP)))}moveSourceMap(){if(!this.sdkInfo.hasRollUpPluginInEtsLoader)return;const e=fse.existsSync(this.pathInfo.getSourceMapIntermediatePath())?this.pathInfo.getSourceMapIntermediatePath():this.getSourceMapSourcePath();if(fse.existsSync(e))if(hvigor_1.coreParameter.properties[const_1.OHOS_ARK_COMPILE_SOURCE_MAP_DIR]){const t=this.getSourceMapPath(hvigor_1.coreParameter.properties[const_1.OHOS_ARK_COMPILE_SOURCE_MAP_DIR]);fse.ensureDirSync(path_1.default.resolve(t,this.moduleName)),fse.copyFileSync(e,path_1.default.resolve(t,this.moduleName,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP))}else fse.ensureDirSync(this.pathInfo.getDefaultSourceMapPath()),fse.copyFileSync(e,path_1.default.resolve(this.pathInfo.getDefaultSourceMapPath(),build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP))}async replaceSourceMapInCoverageMode(){if(!inject_util_js_1.InjectUtil.isOhosTestCoverage())return;const e=path_1.default.join(this.etsAssetsPath,build_directory_const_js_1.BuildArtifactConst.SOURCEMAPS_MAP),t=path_1.default.join(this.pathInfo.getModulePath(),".test/default/intermediates/ohosTest/coverage_sourcemap/ohosTestSourceMap.map");await(0,sourcemap_util_js_1.overWriteSourceMap)(e,t)}initTaskDepends(){this.declareDependsList(make_pack_info_js_1.MakePackInfo.name,cache_native_libs_js_1.CacheNativeLibs.name,generate_metadata_js_1.GenerateMetadata.name),this.declareDepends(syscap_transform_js_1.SyscapTransform.name),this.declareDepends(process_router_map_js_1.ProcessRouterMap.name),this.declareDepends(process_startup_config_js_1.ProcessStartupConfig.name);const e=fse.existsSync(path_1.default.resolve(this.sdkInfo.getEtsLoader(),sdk_const_js_1.ToolChainsConst.ROLL_UP_CONFIG_FILE)),t=fse.existsSync(path_1.default.resolve(this.sdkInfo.getJsLoader(),sdk_const_js_1.ToolChainsConst.ROLL_UP_CONFIG_FILE));if(this._log.debug("initTaskDepends:",`moduleName=${this.moduleName}, taskName=${this.name}, useRollupETS=${e}, useRollupJS=${t}`),inject_util_js_1.InjectUtil.isHotReload()||inject_util_js_1.InjectUtil.isColdReload())return e&&this.declareDepends(inject_util_js_1.InjectUtil.isHotReload()?"HotReloadArkTS":"ColdReloadArkTS"),void(t?this.declareDepends("CompileJS"):this.declareDepends("BuildJS"));const s=this.targetName===ohosTestTargetName?"OhosTest":"";this.targetName===ohosTestTargetName&&this.declareDepends(task_names_js_1.TaskNames.Task.OHOS_TEST_COPY_MOCK_CONFIG_JSON.name),this.declareDepends(this.sdkInfo.hasRollUpPluginInEtsLoader?`${s}CompileArkTS`:`${s}BuildArkTS`),this.declareDepends(this.sdkInfo.hasRollUpPluginInJsLoader?`${s}CompileJS`:`${s}BuildJS`)}getSourceMapPath(e){return path_1.default.isAbsolute(e)?e:path_1.default.resolve(this.projectModel.getProjectDir(),"hvigor",e)}doDependenciesCheck(){if(this.targetService.isDebug())return;const{harDependencies:e,hspDependencies:t,byteCodeHarDependencies:s}=this.collectDependencies();this.doNativeStripDependenciesCheck(e),this.doObfuscationDependenciesCheck(t,s)}doNativeStripDependenciesCheck(e){var t,s,a;if(!1!==(null===(a=null===(s=null===(t=this.targetService.getBuildOption())||void 0===t?void 0:t.nativeLib)||void 0===s?void 0:s.debugSymbol)||void 0===a?void 0:a.strip))return;const o=e.filter(e=>{var t;if(e.isLocal())return!1;return!1===(null===(t=e.getPackageJsonObj().metadata)||void 0===t?void 0:t.nativeDebugSymbol)}).map(e=>e.getPackageName());o.length&&this._log.warn(`HAR dependencies [${o.join(", ")}] contain unstripped .so files. These .so files will not be stripped later.`)}doObfuscationDependenciesCheck(e,t){const s=e.filter(e=>!e.isLocal());if(!s.length&&!t.length)return;let a="";t.length&&(a+=`Bytecode HARs [${t.map(e=>e.getPackageName()).join(", ")}]`),s.length&&(a+=`${a?" and ":""}HSPs [${s.map(e=>e.getPackageName()).join(", ")}]`),this._log.warn(`${a} to integrate are not obfuscated and will not be obfuscated later.`)}collectDependencies(){const e=new dependency_manager_js_1.DependencyManager(this.projectModel.isFaMode(),this.moduleModel,this.projectModel),{npmDependencies:t}=e.collectAllDependencies(),s=[],a=[],o=[];return t.forEach(e=>{e.isByteCodeHarDependency()&&o.push(e);const t=e.getDependencyType();t===dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP?s.push(e):t===dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HAR&&a.push(e)}),{hspDependencies:s,harDependencies:a,byteCodeHarDependencies:o}}async beforeAlwaysAction(){if(await super.beforeAlwaysAction(),this.doDependenciesCheck(),(0,task_util_js_1.doObfuscationCheck)(this.targetService,this._log),inject_util_js_1.InjectUtil.isByteCodeHarOptimize()){const e=this.getImporteesCachePath(hvigor_arkts_compose_1.DIRECT_IMPORTEE_CACHE_FILE_NAME,"CompileArkTS");this.doDevDependencyCheck(e)}}async copyIntermediates(){fse.mkdirsSync(this.fastAppDirPath);const e=[],t=path_1.default.resolve(this.fastAppDirPath,common_const_js_1.CommonConst.ETS),s=path_1.default.resolve(this.fastAppDirPath,common_const_js_1.CommonConst.RESOURCES_PATH),a=(0,integrated_hsp_utils_js_1.getAppInfoByProject)(this.service.getProjectModel()).bundleName;e.push(fse.copy(this.etsAssetsPath,t)),e.push(fse.copy(this.resourcePath,s)),e.push(fse.copyFile(this.indexPath,path_1.default.resolve(this.fastAppDirPath,build_directory_const_js_1.BuildArtifactConst.RESOURCE_INDEX))),e.push(fse.copyFile(this.pkgContextInfoPath,path_1.default.resolve(this.fastAppDirPath,common_const_js_1.CommonConst.PKG_CONTEXT_INFO_JSON)));const o=this.copyJSONFile(this.packageHapJsonPath,path_1.default.resolve(this.fastAppDirPath,common_const_js_1.CommonConst.MODULE_JSON),e=>(e.app.bundleName=a,e)),i=this.copyJSONFile(this.allPackInfoPath[0],path_1.default.resolve(this.fastAppDirPath,build_directory_const_js_1.BuildArtifactConst.PACK_INFO),e=>(e.summary.app.bundleName=a,e));e.push(o),e.push(i),await Promise.all(e)}async copyJSONFile(e,t,s){return fse.readFile(e).then(e=>{let a=JSON.parse(e.toString());return a=s(a),fse.writeFile(t,JSON.stringify(a))}).catch(e=>{this._log.debug("cannot copy intermediate file",e)})}}exports.BasePackHapTask=BasePackHapTask;const packageHapDepends=e=>{const t=[make_pack_info_js_1.MakePackInfo.name,cache_native_libs_js_1.CacheNativeLibs.name,generate_metadata_js_1.GenerateMetadata.name],s=e.getTargetData(),a=e.getSdkInfo();if(t.push(syscap_transform_js_1.SyscapTransform.name),t.push(process_router_map_js_1.ProcessRouterMap.name),inject_util_js_1.InjectUtil.isHotReload()||inject_util_js_1.InjectUtil.isColdReload())return a.hasRollUpPluginInEtsLoader&&t.push(inject_util_js_1.InjectUtil.isHotReload()?"HotReloadArkTS":"ColdReloadArkTS"),t.push(a.hasRollUpPluginInJsLoader?"CompileJS":"BuildJS"),t;s.getTargetName()===ohosTestTargetName&&t.push(task_names_js_1.TaskNames.Task.OHOS_TEST_COPY_MOCK_CONFIG_JSON.name);const o=s.getTargetName()===ohosTestTargetName?"OhosTest":"";return t.push(a.hasRollUpPluginInEtsLoader?`${o}CompileArkTS`:`${o}BuildArkTS`),t.push(a.hasRollUpPluginInJsLoader?`${o}CompileJS`:`${o}BuildJS`),t.push(process_integrated_hsp_js_1.ProcessIntegratedHsp.name),t};exports.packageHapDepends=packageHapDepends;