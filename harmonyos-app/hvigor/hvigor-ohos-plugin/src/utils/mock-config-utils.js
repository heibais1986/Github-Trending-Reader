"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSource2ModuleIdMap=exports.getMockConfigSources=exports.getMockConfigKey2ModuleInfoMap=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),json_util_js_1=require("./json-util.js"),getMockConfigKey2ModuleInfoMap=(e,t)=>{const o={},s=(0,json_util_js_1.getJson5Obj)(e);if(!s||!Object.keys(s).length)return o;const n=new Map;return t.getAllDependencies().forEach(e=>{n.set(e.getDependencyName(),e)}),Object.keys(s).forEach(e=>{const t=e.split(/[/\\]/);let s=t.shift();if("."===s[0])return;if("@"===s[0]&&t.length>0&&(s+=`/${t.shift()}`),!n.has(s))return;const r=n.get(s),u=r.getDependencyRootPath();o[e]={meta:{pkgPath:u,pkgName:r.getPackageName()},filePath:t.length?path_1.default.resolve(u,...t):r.getDependencyMainFilePath()}}),o};exports.getMockConfigKey2ModuleInfoMap=getMockConfigKey2ModuleInfoMap;const getMockConfigSources=(e,t)=>{const o=[],s=(0,json_util_js_1.getJson5Obj)(e);return s?(Object.values(s).forEach(e=>{const s=e.source;if(s){const e=path_1.default.resolve(t,s);fs_extra_1.default.existsSync(e)&&o.push(e)}}),o):o};exports.getMockConfigSources=getMockConfigSources;const getSource2ModuleIdMap=(e,t)=>{const o=new Map,s=(0,json_util_js_1.getJson5Obj)(e);return s?(Object.values(s).forEach(e=>{const s=e.source;if(s){const e=path_1.default.resolve(t,s);fs_extra_1.default.existsSync(e)&&o.set(s,e)}}),o):o};exports.getSource2ModuleIdMap=getSource2ModuleIdMap;