"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.toUnixPath=exports.getCopyOptions=void 0;const fs_1=__importDefault(require("fs")),os_1=__importDefault(require("os")),path_1=__importDefault(require("path")),minimatch_1=__importDefault(require("minimatch"));function getCopyOptions(e){var t,s,a,r;null!==(t=e.isPreview)&&void 0!==t||(e.isPreview=!1);const o=[],i="../share",n=e.aceModuleRoot,u=e.aceModuleBuild||path_1.default.resolve(n,"build"),l=null!==(s=e.copyCodeResourceExcludes)&&void 0!==s?s:[],p=Array.from(new Set(["**/*.ets","**/*.ts","**/*.js",...l]));o.push({src:path_1.default.resolve(n,"**/*"),dest:u,ignore:{ignored:e=>/\.ets$|\.ts$|\.js$/.test(e.name)||p.some(t=>(0,minimatch_1.default)(path_1.default.resolve(e.path,e.name),t,{dot:!0}))},onlyFiles:!0,rename:renameDestFile(n)});const d=path_1.default.resolve(n,i);fs_1.default.existsSync(d)&&o.push({src:path_1.default.resolve(d,"**/*"),dest:path_1.default.resolve(u,i),ignore:{ignored:e=>/\.ets$|\.ts$|\.js$/.test(e.name)},onlyFiles:!0,rename:renameDestFile(d)});"page"===(null!==(a=e.abilityType)&&void 0!==a?a:"page")&&e.aceManifestPath&&fs_1.default.existsSync(e.aceManifestPath)&&o.push({src:e.aceManifestPath,dest:u});const _=/ets_loader_ark$/.test(__dirname),f=null!==(r=e.cachePath)&&void 0!==r?r:path_1.default.resolve(__dirname,"node_modules/.cache");return e.appResource&&fs_1.default.existsSync(e.appResource)&&!_&&e.isPreview&&o.push({src:path_1.default.resolve(__dirname,e.appResource),dest:path_1.default.resolve(__dirname,f)}),{targets:formatCopyPatterns(o)}}function renameDestFile(e){return(t,s,a)=>{a=toUnixPath(a);const r=toUnixPath(e);if(-1!==a.indexOf(r)){let e=a.replace(r,"");return e.startsWith("/")&&(e=e.substring(1)),e}return`${t}.${s}`}}function formatCopyPatterns(e){return e.forEach(e=>{e.src=toUnixPath(e.src),e.dest=toUnixPath(e.dest)}),e}function toUnixPath(e){return"Windows_NT"===os_1.default.type()?path_1.default.posix.join(...e.split(path_1.default.sep)):e}exports.getCopyOptions=getCopyOptions,exports.toUnixPath=toUnixPath;