"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractBuildProfileLoader=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),common_const_js_1=require("../../../const/common-const.js"),json_util_js_1=require("../../json-util.js"),ohos_logger_js_1=require("../../log/ohos-logger.js"),validate_util_js_1=require("../../validate/validate-util.js"),validator_store_js_1=require("../../validate/validator-store.js"),config_file_loader_js_1=require("../config-file-loader.js"),log=ohos_logger_js_1.OhosLogger.getLogger("BuildProfileLoader");class AbstractBuildProfileLoader{getBuildProfileJson5Obj(e,o=!0,i){const t=hvigor_1.hvigor.getNodeByName(e,i);if(void 0===t)return void log.printErrorExit("NODE_NOT_FOUND_BY_NODE_NAME",[e]);const r=path_1.default.resolve(t.getNodePath(),common_const_js_1.CommonConst.PROFILE_JSON5),s=config_file_loader_js_1.configFileLoader.getConfigFileJson(r);if(void 0!==s)return s;if(fs_extra_1.default.existsSync(r)){let i=(0,json_util_js_1.getJson5Obj)(r);return i=this.initializeReplace(i),this.setBuildProfileJson5Obj(e,i,o),i}log.warn(`not found build-profile json file in : ${r}`)}setBuildProfileJson5ObjCheck(e,o,i,t){const r=hvigor_1.hvigor.getNodeByName(e,t);if(void 0===r)return void log.printErrorExit("NODE_NOT_FOUND_BY_NODE_NAME",[e]);const s=path_1.default.resolve(r.getNodePath(),common_const_js_1.CommonConst.PROFILE_JSON5);config_file_loader_js_1.configFileLoader.setConfigFileJson(s,o),i&&this.validateBuildProfile(o,s,i)}validateBuildProfile(e,o,i){const t=validator_store_js_1.ValidatorStore.addValidator(i);try{validate_util_js_1.ValidateUtil.schemaCheckJSObject(e,void 0,t)}catch(e){e instanceof Error&&log.errorMessageExit(e.name,e.message)}}initializeReplace(e){return e}}exports.AbstractBuildProfileLoader=AbstractBuildProfileLoader;