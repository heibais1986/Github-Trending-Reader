"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ohModulesLockLoader=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),const_js_1=require("@ohos/hvigor/src/common/const/const.js"),path_const_1=require("@ohos/hvigor/src/common/const/path-const"),common_const_js_1=require("../../../const/common-const.js"),json_util_js_1=require("../../json-util.js"),config_file_loader_js_1=require("../config-file-loader.js");class OhModulesLockLoader{constructor(){this.lockFilePath=path_1.default.resolve(path_const_1.HVIGOR_PROJECT_ROOT_DIR,common_const_js_1.CommonConst.OH_MODULES,common_const_js_1.CommonConst.OHPM,common_const_js_1.CommonConst.LOCK_JSON5)}getLockJsonObj(){let e=config_file_loader_js_1.configFileLoader.getConfigFileJson(this.lockFilePath);return void 0===e&&(config_file_loader_js_1.configFileLoader.setConfigFileJson(this.lockFilePath,(0,json_util_js_1.getJson5Obj)(this.lockFilePath)),e=config_file_loader_js_1.configFileLoader.getConfigFileJson(this.lockFilePath)),null!=e?e:{}}isModuleInProjectPkgJsonOverrideDependencies(e){var o,n;const i=path_1.default.resolve(path_const_1.HVIGOR_PROJECT_ROOT_DIR,common_const_js_1.CommonConst.OH_PACKAGE_JSON5);return!!(null===(n=(null!==(o=config_file_loader_js_1.configFileLoader.getConfigFileJson(i))&&void 0!==o?o:{}).overrideDependencyMap)||void 0===n?void 0:n[e])}isNeedOverrideWithLockJson(e){return!0===hvigor_1.hvigorCore.getParameter().getProperty(const_js_1.ENABLE_OVERRIDES_DEPENDENCY_MAP)&&this.isModuleInProjectPkgJsonOverrideDependencies(e)}getOverrideDependencyPkgObj(e,o){var n,i,s,t;const r=(0,wdk_1.cloneDeep)(o),_=null===(n=this.getLockJsonObj().overrideDependencyMap)||void 0===n?void 0:n[e];return r&&_&&(r.dependencies=null!==(i=_.dependencies)&&void 0!==i?i:{},r.devDependencies=null!==(s=_.devDependencies)&&void 0!==s?s:{},r.dynamicDependencies=null!==(t=_.dynamicDependencies)&&void 0!==t?t:{}),r}}exports.ohModulesLockLoader=new OhModulesLockLoader;