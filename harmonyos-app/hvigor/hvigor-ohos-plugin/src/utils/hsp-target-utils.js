"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HspTargetUtils=void 0;const task_util_1=require("@ohos/hvigor/src/base/util/task-util"),os_1=__importDefault(require("os")),common_const_js_1=require("../const/common-const.js"),ohos_plugin_id_js_1=require("../plugin/common/ohos-plugin-id.js"),module_task_service_js_1=require("../tasks/service/module-task-service.js"),ohos_logger_1=require("./log/ohos-logger"),target_utils_js_1=require("./target-utils.js");class HspTargetUtils{static calDepHspTargets(e){var t;const o=new Map,r=e.getTargetData(),s=e.getModuleService(),a=s.getModuleModel(),g=a.getName(),l=null!==(t=(0,task_util_1.getAlignTarget)())&&void 0!==t?t:r.getTargetName(),u=r.getProduct().name;return s.getHspModuleDependencyNames().forEach(t=>{const s=a.getModule().findModuleByName(t);s||this._log.printErrorExit("HSP_NOT_FOUND",[t],[[t]]);const i=()=>{const e=`Module '${g}@${l}' depends on shared library module '${t}', `,o=`but neither target '${l}' nor target '${common_const_js_1.DefaultTargetConst.DEFAULT_TARGET}' of module '${t}' is applied to current product '${u}'.${os_1.default.EOL}`,s=`but target '${l}' of module '${t}' is not applied to current product '${u}'.${os_1.default.EOL}`,a=`\tSolution: Apply one of these targets of module '${t}' to product '${u}': ${os_1.default.EOL}\t\t- default`,i=`${os_1.default.EOL}\t\t- ${l}`,_=l===common_const_js_1.DefaultTargetConst.DEFAULT_TARGET?`${e}${s}${a}`:`${e}${o}${a}${i}`;this._log.printErrorExit("HSP_TARGET_NOT_MATCH",[r.getTargetName(),t,_],[[t,g]])},_=s.getPluginById(ohos_plugin_id_js_1.OhosPluginId.OHOS_HSP_PLUGIN).getNeedExecTargetServiceList();0===_.length&&i();const d=target_utils_js_1.TargetUtils.pushTryTargets({projectModel:e.getModuleService().getProjectModel(),moduleName:t,superTargetName:r.getTargetName()}),n=[];for(const e of d){const t=_.find(t=>t.getTargetData().getTargetName()===e&&(0,module_task_service_js_1.checkHasTargetApplyProduct)(t.getTargetData().getModuleModel(),e,u));if(void 0!==t){n.push(t.getTargetData());break}}if(0===n.length&&_.length>0){const e=_.find(e=>(0,module_task_service_js_1.checkHasTargetApplyProduct)(e.getModuleService().getModuleModel(),e.getTargetData().getTargetName(),u));e?n.push(e.getTargetData()):i()}n.forEach(e=>o.set(t,e))}),o}}exports.HspTargetUtils=HspTargetUtils,HspTargetUtils._log=ohos_logger_1.OhosLogger.getLogger("HspTargetUtils");