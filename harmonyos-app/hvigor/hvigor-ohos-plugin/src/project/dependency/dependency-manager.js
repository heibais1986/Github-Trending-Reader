"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEntryPath=exports.getEntryMainFilePath=exports.DependencyManager=void 0;const hvigor_1=require("@ohos/hvigor"),hvigor_arkts_compose_1=require("@ohos/hvigor-arkts-compose"),fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),common_util_js_1=require("../../common/common-util.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),common_const_js_1=require("../../const/common-const.js"),module_type_enum_js_1=require("../../enum/module-type-enum.js"),legacy_module_model_impl_js_1=require("../../model/module/legacy-module-model-impl.js"),core_project_model_impl_js_1=require("../../model/project/core-project-model-impl.js"),har_extend_info_js_1=require("../../tasks/har/har-extend-info.js"),error_url_js_1=require("../../utils/error-url.js"),oh_package_loader_js_1=require("../../utils/loader/file/oh-package-loader.js"),res_model_loader_js_1=require("../../utils/loader/file/res-model-loader.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),base_package_resolver_js_1=require("../../utils/resolver/base-package-resolver.js"),npm_package_resolver_js_1=require("../../utils/resolver/npm-package-resolver.js"),ohpm_package_resolver_js_1=require("../../utils/resolver/ohpm-package-resolver.js"),dependency_builder_js_1=require("./core/dependency-builder.js"),dependency_interface_js_1=require("./core/dependency-interface.js"),module_dependency_info_js_1=require("./module-dependency-info.js"),legacy_dependency_manager_helper_js_1=require("./legacy-dependency-manager-helper.js"),dependency_util_js_1=require("../../utils/dependency-util.js"),copy_resources_util_js_1=require("../../utils/copy-resources-util.js"),file_util_js_1=require("../../utils/file-util.js"),oh_modules_lock_loader_js_1=require("../../utils/loader/file/oh-modules-lock-loader.js"),log=ohos_logger_js_1.OhosLogger.getLogger("ohos-dependency-manager"),solution=`The OpenHarmony npm package or module is not compatible with the current model. Use a compatible OpenHarmony npm package or module. For details about the stage and FA models, see ${error_url_js_1.ErrorUrl.ERROR_URL.modelDiff}.`;class DependencyManager{constructor(e,n,o){this._allDependency=new Set,this._model=n,this._projectModel=o,this._moduleName=n.getName(),this._isFaMode=e,this._isOhpmDependency=this.isOhpmDependency(),this.legacyDependencyManagerHelper=new legacy_dependency_manager_helper_js_1.LegacyDependencyManagerHelper(n.getName())}isOhpmDependency(){return this._projectModel?this._projectModel.isOhpmProject():this._model.isOhpmProject()}createModelDependencyInfo(){const e=(e,n,o)=>n&&e.npm.getDependencyEnum()!==dependency_interface_js_1.DependencyEnum.DEV_DEPENDENCIES||o&&e.npm.getDependencyType()!==dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP,n=this._isOhpmDependency?this._model.getOhPackageJson5Path():this._model.getPackageJsonPath(),{npmDependencies:o,moduleDependencyMap:t,modulePkgNode:s,projectPkgNode:d}=this.getDependenciesByFilter(this._model,n,e,e);return log.debug(`Module ${this._moduleName} Collected Dependency: ${o.map(e=>e.getDependencyRootPath())}`),log.debug(`Module ${this._moduleName}'s total dependency: ${o.length}`),new module_dependency_info_js_1.ModuleDependencyInfo(s.npm,s,d,t,o)}buildSelfDependency(e,n){const o=e instanceof core_project_model_impl_js_1.CoreProjectModelImpl,t=o?e.getProject():e.getModule(),s=this.getFinalOhPkgJsonObj(n),d=this.getHarmonyDependencyType(n,s,n,t.getName());let l;o||(l=[path_1.default.resolve(e.getProjectDir(),"src/main/module.json5"),path_1.default.resolve(e.getProjectDir(),"src/main/module.json")].find(e=>fs_1.default.existsSync(e)));const r=(new dependency_builder_js_1.DependencyBuilder).setDependencyName(t.getName()).setDependencyRootPath(t.getNodeDir()).setPkgJsonPath(n).setPkgJsonObj(s).setIsLocal(!0).setModule(t).setModuleJsonObj(this.getModuleJsonObj(l)).setIsModuleDependency(!o).setDependencyEnum(dependency_interface_js_1.DependencyEnum.DEPENDENCIES);return d&&r.setDependencyType(d),r.buildDefaultModuleDependency()}collectAllDependencies(){const e=this._isOhpmDependency?this._model.getOhPackageJson5Path():this._model.getPackageJsonPath();return this.getDependenciesByFilter(this._model,e,void 0,(e,n,o)=>o||e.npm.getDependencyEnum()!==dependency_interface_js_1.DependencyEnum.DEV_DEPENDENCIES)}collectAllDependenciesForPkgInfo(){const e=this._isOhpmDependency?this._model.getOhPackageJson5Path():this._model.getPackageJsonPath();return this.getDependenciesForPkgInfo(this._model,e,(e,n)=>{var o;return n||(null===(o=e.npm)||void 0===o?void 0:o.getDependencyType())!==dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP})}getDependenciesByFilter(e,n,o,t){this._allDependency.clear();const s=[],d=new Map,l=this.buildSelfDependency(e,n),r={moduleName:this._moduleName,modulePkgJsonPath:n,children:[],npm:l,module:l};this.collectHarDependency(r),this.collectFromTree(r,s,d,o);return{npmDependencies:s,moduleDependencyMap:d,modulePkgNode:r,projectPkgNode:this.collectProjectHarDependencyForHap(d,s,t)}}getDependenciesForPkgInfo(e,n,o,t){this._allDependency.clear();const s=[],d=new Map,l=this.buildSelfDependency(e,n),r={moduleName:this._moduleName,modulePkgJsonPath:n,children:[],npm:l,module:l};this.collectHarDependency(r),this.collectFromTree(r,s,d,o);return{npmDependencies:s,moduleDependencyMap:d,modulePkgNode:r,projectPkgNode:this.collectModuleHarDependencyForHap(d,s,t)}}collectModuleHarDependencyForHap(e,n,o){if(!this._projectModel)return;const t=this._isOhpmDependency?this._projectModel.getOhPackageJson5Path():this._projectModel.getPackageJsonPath(),s=this.buildSelfDependency(this._projectModel,t),d={moduleName:this._moduleName,modulePkgJsonPath:t,children:[],npm:s,module:s};this.collectHarDependency(d);return this.collectFromTree(d,n,e,(e,n,t)=>!o||o(e,n,t)),d}collectAllHspDependencies(){const{moduleDependencyMap:e}=this.collectAllDependencies();return[...e.entries()].filter(([,e])=>e.getDependencyType()===dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP)}collectProjectHarDependencyForHap(e,n,o){if(!this._projectModel)return;const t=this._isOhpmDependency?this._projectModel.getOhPackageJson5Path():this._projectModel.getPackageJsonPath(),s=this.buildSelfDependency(this._projectModel,t),d={moduleName:this._moduleName,modulePkgJsonPath:t,children:[],npm:s,module:s};this.collectHarDependency(d);return this.collectFromTree(d,n,e,(e,n,t)=>!(e.module&&!this._model.isHapModule())&&(!o||o(e,n,t))),d}collectHarDependency(e){const n=[e];for(;n.length>0;){let e=n.shift();if(void 0===e||!fs_1.default.existsSync(e.modulePkgJsonPath))continue;const o=oh_package_loader_js_1.ohPackageLoader.getNodeOhPackagePath(e.modulePkgJsonPath),t=this.getFinalOhPkgJsonObj(o);if(null===t)continue;this.resolveDeps(e,n,dependency_interface_js_1.DependencyEnum.DEPENDENCIES,null==t?void 0:t.dependencies),this.resolveDeps(e,n,dependency_interface_js_1.DependencyEnum.DYNAMIC_DEPENDENCIES,null==t?void 0:t.dynamicDependencies),this.resolveDeps(e,n,dependency_interface_js_1.DependencyEnum.DEV_DEPENDENCIES,null==t?void 0:t.devDependencies);const s=`${e.npm.getDependencyName()}@${e.modulePkgJsonPath}`;let d=hvigor_1.hvigorCore.getCache("DEP_NODE");!d.has(s)&&d.set(s,e)}}resolveDeps(e,n,o,t){for(const s in null!=t?t:{}){this._allDependency.add(`${e.modulePkgJsonPath}@${s}`);const d=t[s];if(Object.prototype.hasOwnProperty.call(t,s)){let t=this.collectDependency(s,d,e.moduleName,e,n,o);t&&e.children.push(t)}}}collectFromTree(e,n,o,t){return this.collectDependenciesFromTree({root:e,npmDeps:n,moduleDepMap:o,filter:t})}collectDependenciesFromTree(e){const{root:n,npmDeps:o,moduleDepMap:t,filter:s,shouldCollect:d}=e,l=[...n.children],r=new Set,c=new Map(o.map(e=>[e.getDependencyName(),e.getDependencyRootPath()]));for(;l.length>0;){const e=l.shift();if(r.has(e.modulePkgJsonPath))continue;if(s&&!s(e,!0,!1))continue;const n=c.get(e.npm.getDependencyName()),i=!d||d(e);if(!n&&i&&(null==o||o.push(e.npm),c.set(e.npm.getDependencyName(),e.npm.getDependencyRootPath())),e.module&&e.module.isLocal()&&i){const n=t.get(e.module.getModuleName());n?(0,dependency_interface_js_1.compareDependencyEnum)(e.module.getDependencyEnum(),n.getDependencyEnum())&&t.set(e.module.getModuleName(),e.module):t.set(e.module.getModuleName(),e.module)}s&&!s(e,!1,!0)||(l.push(...e.children),r.add(e.modulePkgJsonPath))}}collectDependency(e,n,o,t,s,d){var l,r,c,i,a;const _=this._isOhpmDependency?common_const_js_1.CommonConst.OH_PACKAGE_JSON5:common_const_js_1.CommonConst.PACKAGE_JSON,u=(this._isOhpmDependency?new ohpm_package_resolver_js_1.OhpmPackageResolver:new npm_package_resolver_js_1.NpmPackageResolver).resolvePackagePath(e,path_1.default.dirname(t.modulePkgJsonPath),log),p=t.npm.isModuleDependency();if(void 0===u||!fs_1.default.existsSync(u))return void(fs_1.default.existsSync(path_1.default.resolve(this._model.getProjectDir(),common_const_js_1.CommonConst.OH_MODULES))&&!this.isIndirectDevdependency(null==t?void 0:t.modulePkgJsonPath,d)&&log.warn(`The current module '${this._moduleName}' has dependency which is not installed at its ${_}.`));const m=hvigor_1.hvigorCore.getCache("DEP_NODE").get(`${e}@${u}`);if(m){const e={npm:(new dependency_builder_js_1.DependencyBuilder).setDependencyName(m.npm.getDependencyName()).setDependedVersion(n).setDependencyRootPath(m.npm.getDependencyRootPath()).setPkgJsonPath(m.npm.getPackageFilePath()).setPkgJsonObj(m.npm.getPackageJsonObj()).setDependencyType(m.npm.getDependencyType()).setDependencyEnum(d).setModuleJsonObj(m.npm.getModuleJsonObj()).setIsLocal(m.npm.isLocal()).setLastDependencyName(o).setIsModuleDependency(p).buildDefaultNpmDependency(),parent:t,children:[...m.children],moduleName:m.moduleName,modulePkgJsonPath:m.modulePkgJsonPath};return m.module&&(e.module=(new dependency_builder_js_1.DependencyBuilder).setModule(m.module.getModule()).setDependencyName(m.module.getDependencyName()).setDependedVersion(n).setDependencyRootPath(m.module.getDependencyRootPath()).setPkgJsonPath(m.module.getPackageJsonPath()).setPkgJsonObj(m.module.getPackageJsonObj()).setDependencyType(m.module.getDependencyType()).setDependencyEnum(d).setIsLocal(!0).setModuleJsonObj(m.module.getModuleJsonObj()).setLastDependencyName(o).setIsModuleDependency(p).buildDefaultModuleDependency()),e}const y=oh_package_loader_js_1.ohPackageLoader.getNodeOhPackagePath(u),h=this.getFinalOhPkgJsonObj(y),g=null!==(r=null!==(l=this.getHarmonyDependencyType(u,h,t.modulePkgJsonPath,e))&&void 0!==l?l:this.getSODependencyType(h.name))&&void 0!==r?r:dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_OTHER;switch(g){case dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HAP:log.warn(`HAP dependency (module "${e}") detected in path "${t.modulePkgJsonPath}".\n          Try the following:\n          1. Remove the dependency on module "${e}".\n          2. Change module "${e}" to a HAR or HSP.`);case void 0:return}const D=path_1.default.dirname(u);this.checkHarStatusIsCompatibleForHap(D,h),this._allDependency.add(`${u}@${e}`);const P=null===(c=hvigor_1.hvigorCore.getProject())||void 0===c?void 0:c.getAllSubModules();if(!P)return;const j=null!==(i=this.getModuleJsonObj(new base_package_resolver_js_1.BasePackageResolver("src/main/module.json5",common_const_js_1.CommonConst.OH_MODULES).resolvePackagePath(e,path_1.default.dirname(t.modulePkgJsonPath),log)))&&void 0!==i?i:this.getModuleJsonObj(new base_package_resolver_js_1.BasePackageResolver("src/main/module.json",common_const_js_1.CommonConst.OH_MODULES).resolvePackagePath(e,path_1.default.dirname(t.modulePkgJsonPath),log));let f,E=u,v=!1;const N=P.find(e=>e.getNodeDir()===D);if(N){E=oh_package_loader_js_1.ohPackageLoader.getNodeOhPackagePath(path_1.default.join(N.getNodeDir(),_));v=!0,f=(new dependency_builder_js_1.DependencyBuilder).setModule(N).setDependencyName(e).setDependedVersion(n).setLastDependencyName(t.moduleName).setDependencyRootPath(N.getNodeDir()).setPkgJsonPath(E).setPkgJsonObj(h).setDependencyType(g).setDependencyEnum(d).setIsLocal(!0).setModuleJsonObj(j).setIsModuleDependency(p).buildDefaultModuleDependency()}const M=oh_package_loader_js_1.ohPackageLoader.getOriginPathFromUpdatePath([E])[0],O=(new dependency_builder_js_1.DependencyBuilder).setDependencyName(e).setDependedVersion(n).setDependencyRootPath(M).setPkgJsonPath(E).setPkgJsonObj(h).setDependencyType(g).setDependencyEnum(d).setModuleJsonObj(j).setIsLocal(v).setIsModuleDependency(p).buildDefaultNpmDependency(),k={moduleName:null!==(a=null==f?void 0:f.getModuleName())&&void 0!==a?a:"",modulePkgJsonPath:u,parent:t,children:[],npm:O,module:f};return g!==dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HAR&&g!==dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_OTHER&&g!==dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP||s.push(k),k}getModuleJsonObj(e){if(void 0!==e&&fs_1.default.existsSync(e))return(0,dependency_util_js_1.getJson5Obj)(e)}getDependencyTypeByProfile(e){const n=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.MODULE_JSON5),o=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.MODULE_JSON),t=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.CONFIG_JSON);return this.getDependencyTypeByProfileType(n)||this.getDependencyTypeByProfileType(o)||this.getDependencyTypeByProfileType(t)}getDependencyTypeByProfileType(e){var n,o,t,s,d,l,r,c,i,a;if(!fs_1.default.existsSync(e))return;const _=(0,dependency_util_js_1.getJson5Obj)(e),u=(null===(n=_.module)||void 0===n?void 0:n.type)===module_type_enum_js_1.ModuleType.Shared,p=(null===(o=_.module)||void 0===o?void 0:o.type)===module_type_enum_js_1.ModuleType.Har||(null===(s=null===(t=_.module)||void 0===t?void 0:t.distro)||void 0===s?void 0:s.moduleType)===module_type_enum_js_1.ModuleType.Har,m=(null===(d=_.module)||void 0===d?void 0:d.type)===module_type_enum_js_1.ModuleType.Entry||(null===(l=_.module)||void 0===l?void 0:l.type)===module_type_enum_js_1.ModuleType.Feature||(null===(c=null===(r=_.module)||void 0===r?void 0:r.distro)||void 0===c?void 0:c.moduleType)===module_type_enum_js_1.ModuleType.Entry||(null===(a=null===(i=_.module)||void 0===i?void 0:i.distro)||void 0===a?void 0:a.moduleType)===module_type_enum_js_1.ModuleType.Feature;return u?dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP:p?dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HAR:m?dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HAP:void 0}checkHspOrHarStatusByProfile(e){const n=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.MODULE_JSON5),o=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.MODULE_JSON),t=path_1.default.resolve(e,"src","main",common_const_js_1.CommonConst.CONFIG_JSON);return this.checkHspOrHarStatus(n,!1)||this.checkHspOrHarStatus(o,!1)||this.checkHspOrHarStatus(t,!0)}checkHspOrHarStatus(e,n){var o,t,s,d;if(!fs_1.default.existsSync(e))return!1;const l=(0,dependency_util_js_1.getJson5Obj)(e),r=(null===(o=l.module)||void 0===o?void 0:o.type)===module_type_enum_js_1.ModuleType.Shared;return((null===(t=l.module)||void 0===t?void 0:t.type)===module_type_enum_js_1.ModuleType.Har||(null===(d=null===(s=l.module)||void 0===s?void 0:s.distro)||void 0===d?void 0:d.moduleType)===module_type_enum_js_1.ModuleType.Har||r)&&n&&log.printErrorExit("MODEL_NOT_CONSISTENT",[this._moduleName],[[solution,e]]),!0}getHarmonyDependencyType(e,n,o,t){var s,d;if(!e||null===n)return;const l=path_1.default.dirname(e),r=null!==(d=null===(s=oh_package_loader_js_1.ohPackageLoader.getOriginPathFromUpdatePath([e]))||void 0===s?void 0:s[0])&&void 0!==d?d:l,c=this.isHarForDiffPackManagement(l,n);this._isFaMode?this.legacyDependencyManagerHelper.checkHspOrHarStatusForFAByProfile(l,n):this.checkHspOrHarStatusByProfile(l);const i=this.getDependencyTypeByProfile(r);return c&&this._allDependency.has(`${e}@${t}`)&&e===o&&i===dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_HSP&&log.printErrorExit("HSP_RELY_HSP",[this._moduleName,l]),c&&n.name?i:void 0}isHarForDiffPackManagement(e,n){return this._isOhpmDependency?fs_1.default.existsSync(e):fs_1.default.existsSync(e)&&void 0!==n.ohos}checkHarStatusIsCompatibleForHap(e,n){var o;if(this._model instanceof core_project_model_impl_js_1.CoreProjectModelImpl)return;const t=this._model;if(t.isHarModule())return;const s=this._isOhpmDependency?n.artifactType:null===(o=n.ohos)||void 0===o?void 0:o.artifactType;void 0!==s&&s!==har_extend_info_js_1.ArtifactType.ORIGINAL&&t instanceof legacy_module_model_impl_js_1.LegacyModuleModelImpl&&log.printErrorExit("FA_RELY_OH_NPM",[this._moduleName,e],[[solution]])}static isLocalDependencyForSo(e){return!e.includes("oh_modules")}static isLocalDependency(e,n){return n.has(e.getDependencyRootPath())}static getModuleNameFromOhPkgJson(e){var n;const o=oh_package_loader_js_1.ohPackageLoader.getNodeOhPackagePath(path_1.default.resolve(e,common_const_js_1.CommonConst.OH_PACKAGE_JSON5));if(!fs_1.default.existsSync(o))return"";const t=(0,dependency_util_js_1.getJson5Obj)(o);return null!==(n=null==t?void 0:t.name)&&void 0!==n?n:""}static getRemoteDependencyRouterMapObjList(e){var n,o;const t=path_1.default.resolve(e.getDependencyRootPath(),build_directory_const_js_1.BuildDirConst.SRC,build_directory_const_js_1.BuildDirConst.MAIN),s=this.getModuleObjByRemoteDependency(e),d=null!==(n=(0,common_util_js_1.parsingProfileName)(null==s?void 0:s.module.routerMap))&&void 0!==n?n:void 0;if(!d)return;const l=path_1.default.resolve(t,build_directory_const_js_1.BuildDirConst.RESOURCES_BASE_PROFILE_DIR,`${d}.json`),r=(0,dependency_util_js_1.getJson5Obj)(l);return r.routerMap.forEach(n=>{Object.assign(n,{moduleNodeDir:e.getDependencyRootPath()})}),null!==(o=r.routerMap)&&void 0!==o?o:void 0}static getLocalDependencyRouterMapObjList(e,n,o=common_const_js_1.DefaultTargetConst.DEFAULT_TARGET){var t;if(!e)return;const s=this.getModuleModelByDependency(e,n);if(!s)return;const d=this.getDependencyModuleRouterMapJsonPath(s,o);if(!d||!fs_1.default.existsSync(d))return;const l=(0,dependency_util_js_1.getJson5Obj)(d);return l.routerMap.forEach(e=>{Object.assign(e,{moduleNodeDir:s.getModule().getNodeDir()})}),null!==(t=l.routerMap)&&void 0!==t?t:void 0}static getDependencyModuleRouterMapJsonPath(e,n=common_const_js_1.DefaultTargetConst.DEFAULT_TARGET){var o,t;if(!e)return;const s=this.getRouterMapJsonFileName(e);if(!s)return;const d=[],l=e.getModule().getNodeDir(),r=e.getProfileOpt();if(null===(o=null==r?void 0:r.targets)||void 0===o?void 0:o.length){const e=r.targets.find(e=>e.name===n);d.push(...file_util_js_1.FileUtil.convertToAbsolutePaths((null===(t=null==e?void 0:e.resource)||void 0===t?void 0:t.directories)||[],l))}for(const e of d){const n=path_1.default.resolve(e,"base","profile",`${s}.json`);if(fs_1.default.existsSync(n))return n}return path_1.default.resolve(e.getModule().getNodeDir(),build_directory_const_js_1.BuildDirConst.SRC,build_directory_const_js_1.BuildDirConst.MAIN,build_directory_const_js_1.BuildDirConst.RESOURCES_BASE_PROFILE_DIR,`${s}.json`)}static getRouterMapJsonFileName(e){if(!e)return;const n=path_1.default.resolve(e.getModule().getNodeDir(),build_directory_const_js_1.BuildDirConst.SRC,build_directory_const_js_1.BuildDirConst.MAIN,common_const_js_1.CommonConst.MODULE_JSON5),o=res_model_loader_js_1.resModelLoader.getModuleJson(n).module.routerMap;return(0,common_util_js_1.parsingProfileName)(o)}static getModuleModelByDependency(e,n){if(e.isLocal())return n.getAllModules().find(n=>n.getProjectDir()===e.getDependencyRootPath())}static getModuleObjByRemoteDependency(e){const n=path_1.default.resolve(e.getDependencyRootPath(),build_directory_const_js_1.BuildDirConst.SRC,build_directory_const_js_1.BuildDirConst.MAIN),o=path_1.default.resolve(n,common_const_js_1.CommonConst.MODULE_JSON),t=path_1.default.resolve(n,common_const_js_1.CommonConst.MODULE_JSON5),s=fs_1.default.existsSync(o)?o:fs_1.default.existsSync(t)?t:"";return(0,dependency_util_js_1.getJson5Obj)(s)}getSODependencyType(e){return(null==e?void 0:e.includes(".so"))?dependency_interface_js_1.DependencyType.DEPENDENCY_TYPE_SO:void 0}isIndirectDevdependency(e,n){return!!e&&((0,copy_resources_util_js_1.toUnixPath)(e).includes("/oh_modules/")&&n===dependency_interface_js_1.DependencyEnum.DEV_DEPENDENCIES)}getFinalOhPkgJsonObj(e){let n=(0,dependency_util_js_1.getJson5Obj)(e);return n&&n.name&&oh_modules_lock_loader_js_1.ohModulesLockLoader.isNeedOverrideWithLockJson(n.name)&&(n=oh_modules_lock_loader_js_1.ohModulesLockLoader.getOverrideDependencyPkgObj(n.name,n)),n}}function getEntryMainFilePath(e,n){const o=path_1.default.resolve(e,(0,hvigor_arkts_compose_1.findNodeEntryFiles)(n)[0]);if(fs_1.default.existsSync(o))return o;{const o=getEntryPath(n.main,n.types),t=path_1.default.resolve(e,o);return fs_1.default.existsSync(t)?t:""}}function getEntryPath(e,n){return e&&""!==e?e:n&&""!==n?n:build_directory_const_js_1.BuildArtifactConst.INDEX_ETS}exports.DependencyManager=DependencyManager,exports.getEntryMainFilePath=getEntryMainFilePath,exports.getEntryPath=getEntryPath;